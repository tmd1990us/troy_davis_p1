<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View All Reimbursements</title>

    <link rel="stylesheet" type="text/css" href="/ers/css/ers_styles.css"/>

</head>
<body>

    <div class="login-container">
        <h4>View All Employee Reimbursements</h4>
    </div>

    </br>
    <form method="POST" action="/ers/api/submit_reimbursement_request">
        </br>
        <label for="type">Select Type</label>
        <select class="form-control" id="type" name="type">
            <option>Lodging</option>
            <option>Travel</option>
            <option>Food</option>
            <option>Other</option>
        </select>
        </br>
        <button type="submit" class="btn btn-secondary">Filter By Type</button>
    </form>

    <form method="GET" action="/ers/api/view_all_reimbursements_by_status">
        </br>
        <label for="status">Select Status</label>
        <select class="form-control" id="status" name="status">
            <option>Pending</option>
            <option>Approved</option>
            <option>Denied</option>
            <option>Closed</option>
        </select>
        </br>
        <button type="submit" class="btn btn-danger">Filter By Status</button>
    </form>


    <div id="showData"></div>
<!-- JS, Popper.js, and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

<script>
    
    let data;    
    fetch('/ers/api/json/view_all_reimbursements_by_status').then(
        function(u){ return u.json();}
      ).then(
        function(json){
          data = json;

        // Find a <tabe> element with id="view_all_reimbursements_table":
        var table = document.createElement("table");

    
        // EXTRACT VALUE FOR HTML HEADER. 
        // ('Book ID', 'Book Name', 'Category' and 'Price')
        var col = [];
        for (var i = 0; i < data.length; i++) {
            for (var key in data[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }

        // // CREATE DYNAMIC TABLE.
        // var table = document.createElement("table");

        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

        var tr = table.insertRow(-1);                   // TABLE ROW.

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        // ADD JSON DATA TO THE TABLE AS ROWS.
        for (var i = 0; i < data.length; i++) {

            tr = table.insertRow(-1);

            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = data[i][col[j]];
            }
        }

        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("showData");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
    })

</script>

</body>
</html>